<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Kubernetes Prometheus 搭建 &mdash; k8s 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="k8s 1.0 documentation" href="../index.html" />
    <link rel="up" title="Kubernets Notes" href="index.html" />
    <link rel="next" title="Guestbook Demo" href="app.html" />
    <link rel="prev" title="Kubernetes Heapster 搭建" href="heapster.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="app.html" title="Guestbook Demo"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="heapster.html" title="Kubernetes Heapster 搭建"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">k8s 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Kubernets Notes</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="kubernetes-prometheus">
<span id="kubernetes-dns"></span><h1>Kubernetes Prometheus 搭建<a class="headerlink" href="#kubernetes-prometheus" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple">
<li>以下所以shell命令都是在root用户下执行</li>
<li>Kubernetes集群环境已搭建好，请参考 <a class="reference internal" href="environment.html#kubernetes-cluster-environment"><em>Kubernetes 集群环境搭建</em></a></li>
</ol>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="71%" />
<col width="29%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>docker镜像</td>
<td>version</td>
</tr>
<tr class="row-even"><td>gcr.io/google_containers/prom/node-exporter</td>
<td><tt class="docutils literal"><span class="pre">v1.8</span></tt></td>
</tr>
<tr class="row-odd"><td>gcr.io/google_containers/prom/prometheus</td>
<td><tt class="docutils literal"><span class="pre">v1</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="deploy">
<h2>Deploy<a class="headerlink" href="#deploy" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">准备prometheus-config.yaml:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus-config</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="l l-Scalar l-Scalar-Plain">data</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">prometheus.yml</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
    <span class="no">global:</span>
      <span class="no">scrape_interval: 30s</span>
      <span class="no">scrape_timeout: 30s</span>
    <span class="no">scrape_configs:</span>
    <span class="no">- job_name: &#39;prometheus&#39;</span>
      <span class="no">static_configs:</span>
        <span class="no">- targets: [&#39;localhost:9090&#39;]</span>
    <span class="no">- job_name: &#39;kubernetes-apiservers&#39;</span>
      <span class="no">scheme: https</span>
      <span class="no">tls_config:</span>
        <span class="no">ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>
      <span class="no">bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token</span>
      <span class="no">kubernetes_sd_configs:</span>
      <span class="no">- role: endpoints</span>
      <span class="no">relabel_configs:</span>
      <span class="no">- source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]</span>
        <span class="no">action: keep</span>
        <span class="no">regex: default;kubernetes;https</span>
    <span class="no">- job_name: &#39;kubernetes-nodes&#39;</span>
      <span class="no">scheme: https</span>
      <span class="no">tls_config:</span>
        <span class="no">ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>
        <span class="no">insecure_skip_verify: true</span>
      <span class="no">bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token</span>
      <span class="no">kubernetes_sd_configs:</span>
      <span class="no">- role: node</span>
      <span class="no">relabel_configs:</span>
      <span class="no">- action: labelmap</span>
        <span class="no">regex: __meta_kubernetes_node_label_(.+)</span>
      <span class="no">- target_label: __address__</span>
        <span class="no">replacement: kubernetes.default.svc.cluster.local:443</span>
      <span class="no">- target_label: __scheme__</span>
        <span class="no">replacement: https</span>
      <span class="no">- source_labels: [__meta_kubernetes_node_name]</span>
        <span class="no">regex: (.+)</span>
        <span class="no">target_label: __metrics_path__</span>
        <span class="no">replacement: /api/v1/nodes/${1}/proxy/metrics</span>
    <span class="no">- job_name: &#39;kubernetes-cadvisor&#39;</span>
      <span class="no">scheme: https</span>
      <span class="no">tls_config:</span>
        <span class="no">ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>
        <span class="no">insecure_skip_verify: true</span>
      <span class="no">bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token</span>
      <span class="no">kubernetes_sd_configs:</span>
      <span class="no">- role: node</span>
      <span class="no">relabel_configs:</span>
      <span class="no">- action: labelmap</span>
        <span class="no">regex: __meta_kubernetes_node_label_(.+)</span>
      <span class="no">- target_label: __address__</span>
        <span class="no">replacement: kubernetes.default.svc:443</span>
      <span class="no">- source_labels: [__meta_kubernetes_node_name]</span>
        <span class="no">regex: (.+)</span>
        <span class="no">target_label: __metrics_path__</span>
        <span class="no">replacement: /api/v1/nodes/${1}/proxy/metrics/cadvisor</span>
    <span class="no">- job_name: &#39;kubernetes-service-endpoints&#39;</span>
      <span class="no">kubernetes_sd_configs:</span>
      <span class="no">- role: endpoints</span>
      <span class="no">relabel_configs:</span>
      <span class="no">- source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]</span>
        <span class="no">action: keep</span>
        <span class="no">regex: true</span>
      <span class="no">- source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]</span>
        <span class="no">action: replace</span>
        <span class="no">target_label: __scheme__</span>
        <span class="no">regex: (https?)</span>
      <span class="no">- source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]</span>
        <span class="no">action: replace</span>
        <span class="no">target_label: __metrics_path__</span>
        <span class="no">regex: (.+)</span>
      <span class="no">- source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port]</span>
        <span class="no">action: replace</span>
        <span class="no">target_label: __address__</span>
        <span class="no">regex: (.+)(?::\d+);(\d+)</span>
        <span class="no">replacement: $1:$2</span>
<span class="hll">      <span class="no">- action: labelmap</span>
</span>        <span class="no">regex: __meta_kubernetes_service_label_(.+)</span>
      <span class="no">- source_labels: [__meta_kubernetes_service_namespace]</span>
        <span class="no">action: replace</span>
        <span class="no">target_label: kubernetes_namespace</span>
      <span class="no">- source_labels: [__meta_kubernetes_service_name]</span>
        <span class="no">action: replace</span>
        <span class="no">target_label: kubernetes_name</span>
    <span class="no">- job_name: &#39;kubernetes-services&#39;</span>
      <span class="no">metrics_path: /probe</span>
      <span class="no">params:</span>
        <span class="no">module: [http_2xx]</span>
      <span class="no">kubernetes_sd_configs:</span>
      <span class="no">- role: service</span>
      <span class="no">relabel_configs:</span>
      <span class="no">- source_labels: [__meta_kubernetes_service_annotation_prometheus_io_probe]</span>
        <span class="no">action: keep</span>
        <span class="no">regex: true</span>
      <span class="no">- source_labels: [__address__]</span>
        <span class="no">target_label: __param_target</span>
      <span class="no">- target_label: __address__</span>
        <span class="no">replacement: blackbox</span>
      <span class="no">- source_labels: [__param_target]</span>
        <span class="no">target_label: instance</span>
      <span class="no">- action: labelmap</span>
        <span class="no">regex: __meta_kubernetes_service_label_(.+)</span>
      <span class="no">- source_labels: [__meta_kubernetes_service_namespace]</span>
        <span class="no">target_label: kubernetes_namespace</span>
      <span class="no">- source_labels: [__meta_kubernetes_service_name]</span>
        <span class="no">target_label: kubernetes_name</span>
    <span class="no">- job_name: &#39;kubernetes-pods&#39;</span>
      <span class="no">kubernetes_sd_configs:</span>
      <span class="no">- role: pod</span>
      <span class="no">relabel_configs:</span>
      <span class="no">- source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]</span>
        <span class="no">action: keep</span>
        <span class="no">regex: true</span>
      <span class="no">- source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]</span>
        <span class="no">action: replace</span>
        <span class="no">target_label: __metrics_path__</span>
        <span class="no">regex: (.+)</span>
      <span class="no">- source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]</span>
        <span class="no">action: replace</span>
        <span class="no">regex: (.+):(?:\d+);(\d+)</span>
        <span class="no">replacement: ${1}:${2}</span>
        <span class="no">target_label: __address__</span>
      <span class="no">- action: labelmap</span>
        <span class="no">regex: __meta_kubernetes_pod_label_(.+)</span>
      <span class="no">- source_labels: [__meta_kubernetes_pod_namespace]</span>
        <span class="no">action: replace</span>
        <span class="no">target_label: kubernetes_namespace</span>
      <span class="no">- source_labels: [__meta_kubernetes_pod_name]</span>
        <span class="no">action: replace</span>
        <span class="no">target_label: kubernetes_pod_name</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">准备prometheus-deployment.yaml</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus-deployment</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus:v1.6.3</span>
        <span class="l l-Scalar l-Scalar-Plain">imagePullPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
        <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;/bin/prometheus&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">args</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;-config.file=/etc/prometheus/prometheus.yml&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;-storage.local.path=/prometheus&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;-storage.local.retention=24h&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">9090</span>
          <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
        <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="s">&quot;/prometheus&quot;</span>
<span class="hll">          <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">data</span>
</span>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="s">&quot;/etc/prometheus&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config-volume</span>
        <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">requests</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100m</span>
            <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100Mi</span>
          <span class="l l-Scalar l-Scalar-Plain">limits</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">500m</span>
            <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2500Mi</span>
      <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">emptyDir</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">data</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">configMap</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus-config</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config-volume</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">准备prometheus-service.yaml</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">9090</span>
      <span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">9090</span>
      <span class="l l-Scalar l-Scalar-Plain">nodePort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">30017</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">create pod from prometheus-config.yaml prometheus-deployment.yaml prometheus-service.yaml</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">[root@master ~]#</span> kubectl create -f prometheus-config.yaml
<span class="gp">[root@master ~]#</span> kubectl create -f prometheus-deployment.yaml
<span class="gp">[root@master ~]#</span> kubectl create -f prometheus-service.yaml
</pre></div>
</div>
</li>
<li><p class="first">准备node-export.yaml</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node-exporter</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node-exporter</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node-exporter</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node-exporter:v0.14.0</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node-exporter</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">9100</span>
          <span class="l l-Scalar l-Scalar-Plain">hostPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">9100</span>
          <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">scrape</span>
        <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">data-disk</span>
          <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/data-disk</span>
          <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">root-disk</span>
          <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/root-disk</span>
          <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">data-disk</span>
          <span class="l l-Scalar l-Scalar-Plain">hostPath</span><span class="p p-Indicator">:</span>
<span class="hll">            <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/localdata</span>
</span>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">root-disk</span>
          <span class="l l-Scalar l-Scalar-Plain">hostPath</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
      <span class="l l-Scalar l-Scalar-Plain">hostNetwork</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="l l-Scalar l-Scalar-Plain">hostPID</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="l l-Scalar l-Scalar-Plain">tolerations</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">effect</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NoSchedule</span>
        <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node-role.kubernetes.io/master</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">effect</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NoSchedule</span>
        <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node.cloudprovider.kubernetes.io/uninitialized</span>
        <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="s">&quot;true&quot;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">准备node-export-svc.yaml</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node-exporter</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
  <span class="l l-Scalar l-Scalar-Plain">annotations</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">prometheus.io/scrape</span><span class="p p-Indicator">:</span> <span class="s">&#39;true&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">k8s-app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node-exporter</span>
    <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/cluster-service</span><span class="p p-Indicator">:</span> <span class="s">&quot;true&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">addonmanager.kubernetes.io/mode</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Reconcile</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">clusterIP</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">None</span>
  <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">scrape</span>
    <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">9100</span>
    <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node-exporter</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">create pod from node-export.yaml</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">[root@master ~]#</span> kubectl create -f node-export.yaml
</pre></div>
</div>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Kubernetes Prometheus 搭建</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#deploy">Deploy</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="heapster.html"
                        title="previous chapter">Kubernetes Heapster   搭建</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="app.html"
                        title="next chapter">Guestbook Demo</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/k8s/prometheus.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="app.html" title="Guestbook Demo"
             >next</a> |</li>
        <li class="right" >
          <a href="heapster.html" title="Kubernetes Heapster 搭建"
             >previous</a> |</li>
        <li><a href="../index.html">k8s 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Kubernets Notes</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2017, zhengchuan.hu@easystack.cn.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>